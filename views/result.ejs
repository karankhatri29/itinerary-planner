<!-- views/result.ejs -->
<% lang="java.math.util.*" %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Tamil Nadu Itinerary</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4 mb-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2>Your <%= plan.location %> Itinerary</h2>
                    <button class="btn btn-light" onclick="window.print()">Print Itinerary</button>
                </div>
            </div>
            <div class="card-body">
                <div class="itinerary-summary mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <h4>Trip Summary</h4>
                            <p><strong>Location:</strong> <%= plan.location %></p>
                            <p><strong>Dates:</strong> <%= plan.startDate %> to <%= plan.endDate %></p>
                            <p><strong>Duration:</strong> <%= plan.duration %> days</p>
                            <p><strong>Travelers:</strong> <%= plan.travelers %> <%= plan.travelers > 1 ? 'people' : 'person' %></p>
                        </div>
                        <div class="col-md-6">
                            <h4>Budget Breakdown</h4>
                            <p><strong>Total Budget:</strong> ₹<%= plan.budget.toLocaleString() %></p>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-success" role="progressbar" >
                                    Accommodation (₹<%= plan.budgetBreakdown.accommodation.toLocaleString() %>)
                                </div>
                            </div>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-info" role="progressbar" >
                                    Transport (₹<%= plan.budgetBreakdown.transport.toLocaleString() %>)
                                </div>
                            </div>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-warning" role="progressbar" >
                                    Activities (₹<%= plan.budgetBreakdown.activities.toLocaleString() %>)
                                </div>
                            </div>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-danger" role="progressbar">
                                    Food (₹<%= plan.budgetBreakdown.food.toLocaleString() %>)
                                </div>
                            </div>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-secondary" role="progressbar" ">
                                    Miscellaneous (₹<%= plan.budgetBreakdown.miscellaneous.toLocaleString() %>)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accommodation-transport mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Accommodation Details</h4>
                                </div>
                                <div class="card-body">
                                    <h5><%= plan.accommodation.name %></h5>
                                    <p><%= plan.accommodation.address %></p>
                                    <p><strong>Type:</strong> <%= plan.accommodation.type %></p>
                                    <p><strong>Price:</strong> ₹<%= plan.accommodation.pricePerNight.toLocaleString() %> per night</p>
                                    <p><strong>Total:</strong> ₹<%= plan.accommodation.totalPrice.toLocaleString() %></p>
                                    <p><strong>Contact:</strong> <%= plan.accommodation.contact %></p>
                                    <% if (plan.accommodation.amenities && plan.accommodation.amenities.length > 0) { %>
                                        <p><strong>Amenities:</strong> <%= plan.accommodation.amenities.join(', ') %></p>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Transport Details</h4>
                                </div>
                                <div class="card-body">
                                    <h5><%= plan.transport.type %></h5>
                                    <% if (plan.transport.type === 'Car Rental') { %>
                                        <p><strong>Rental Company:</strong> <%= plan.transport.company %></p>
                                        <p><strong>Vehicle Type:</strong> <%= plan.transport.vehicleType %></p>
                                        <p><strong>Rate:</strong> ₹<%= plan.transport.ratePerDay.toLocaleString() %> per day</p>
                                    <% } else if (plan.transport.type === 'Cab Services') { %>
                                        <p><strong>Service Provider:</strong> <%= plan.transport.company %></p>
                                        <p><strong>Package:</strong> <%= plan.transport.package %></p>
                                        <p><strong>Rate:</strong> ₹<%= plan.transport.ratePerDay.toLocaleString() %> per day</p>
                                    <% } else { %>
                                        <p><strong>Available Options:</strong></p>
                                        <ul>
                                            <% plan.transport.options.forEach(option => { %>
                                                <li><%= option.name %> - ₹<%= option.cost.toLocaleString() %></li>
                                            <% }); %>
                                        </ul>
                                    <% } %>
                                    <p><strong>Total Transport Cost:</strong> ₹<%= plan.transport.totalCost.toLocaleString() %></p>
                                    <p><strong>Contact:</strong> <%= plan.transport.contact %></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="mb-3">Your Day-by-Day Itinerary</h3>
                
                <div class="daily-itinerary">
                    <% plan.dailyItinerary.forEach((day, index) => { %>
                        <div class="card mb-3">
                            <div class="card-header bg-info text-white">
                                <h4>Day <%= index + 1 %>: <%= day.date %></h4>
                            </div>
                            <div class="card-body">
                                <div class="timeline">
                                    <% day.activities.forEach(activity => { %>
                                        <div class="timeline-item">
                                            <div class="timeline-time"><%= activity.time %></div>
                                            <div class="timeline-content">
                                                <h5><%= activity.name %></h5>
                                                <p><%= activity.description %></p>
                                                <% if (activity.location) { %>
                                                    <p><strong>Location:</strong> <%= activity.location %></p>
                                                <% } %>
                                                <% if (activity.cost) { %>
                                                    <p><strong>Cost:</strong> ₹<%= activity.cost.toLocaleString() %></p>
                                                <% } %>
                                                <% if (activity.notes) { %>
                                                    <p><strong>Notes:</strong> <%= activity.notes %></p>
                                                <% } %>
                                                <% if (activity.category) { %>
                                                    <span class="badge bg-primary"><%= activity.category %></span>
                                                <% } %>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                                
                                <% if (day.meals && day.meals.length > 0) { %>
                                    <div class="meals mt-3">
                                        <h5>Recommended Meals</h5>
                                        <div class="row">
                                            <% day.meals.forEach(meal => { %>
                                                <div class="col-md-4 mb-2">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <h6><%= meal.type %> at <%= meal.place %></h6>
                                                            <p><%= meal.description %></p>
                                                            <p><small>Budget: ₹<%= meal.cost.toLocaleString() %></small></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            <% }); %>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                </div>
                
                <div class="additional-info mb-4">
                    <h3 class="mb-3">Additional Information</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h4>Local Tips</h4>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                                        <% plan.localTips.forEach(tip => { %>
                                            <li class="list-group-item"><%= tip %></li>
                                        <% }); %>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h4>Emergency Contacts</h4>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                                        <% plan.emergencyContacts.forEach(contact => { %>
                                            <li class="list-group-item">
                                                <strong><%= contact.name %>:</strong> <%= contact.number %>
                                            </li>
                                        <% }); %>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="actions d-flex justify-content-between">
                    <a href="/" class="btn btn-secondary">Create New Plan</a>
                    <button class="btn btn-primary" id="saveItinerary">Save Itinerary</button>
                    <button class="btn btn-success" id="shareItinerary">Share Itinerary</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/itinerary-actions.js"></script>
</body>
</html>